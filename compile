#! /bin/bash
set -ex

MAJOR=$1
MINOR=$2
PATCH=$3
TOOLSET=$4
VARIANT=$5
SUFFIX=$6

export VERSION=$MAJOR\_$MINOR\_$PATCH
echo Building Boost_$VERSION $TOOLSET $VARIANT

cd $VERSION

CPPSTD=${CXXSTD:-"c++17"}
OPTIONS="install cxxflags=-std=$CPPSTD define=BOOST_NO_AUTO_PTR --without-fiber --without-locale --without-mpi --without-python"

if test -e /proc/
then {
    export CPUCOUNT=$(grep -c ^processor /proc/cpuinfo)
    time ./bjam -j$CPUCOUNT toolset=$TOOLSET $VARIANT link=shared --prefix=$(pwd)/../boost/$VERSION/$TOOLSET/$VARIANT$SUFFIX $OPTIONS $EXTRA_OPTS $BOOST_EXTRA_OPTS
}
else {
    export CPUCOUNT=$(sysctl -n hw.ncpu)
    time ./bjam -j$CPUCOUNT toolset=clang-darwin pch=off release --prefix=$(pwd)/../boost/$VERSION/$TOOLSET/$VARIANT$SUFFIX $OPTIONS $EXTRA_OPTS $CLANG_OPTS $BOOST_EXTRA_OPTS
}
fi
