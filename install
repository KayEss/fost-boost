#! /bin/bash
cd `dirname $0`

if [[ "$1" == "karmic" || "$1" == "lucid" || "$1" == "maverick" || "$1" == "natty" ]]
then {
    if [[ "$1" == "maverick" || "$1" == "natty" ]]
    then {
         BOOST_MAJOR=42
    }
    elif [ "$1" == "lucid" ]
    then {
        BOOST_MAJOR=40
    }
    else {
        BOOST_MAJOR=38
    }
    fi

    echo Removing boost-build.jam
    rm -f ../boost-build.jam

    echo Making boost-version.jam
    echo BUILD_DIRECTORY = \"../build.tmp/$1\" \;>../boost-version.jam

    echo Creating local bjam
    echo \#\!/bin/bash>../bjam
    echo `which bjam` \$\*>>../bjam
    chmod +x ../bjam

    echo Creating target preservation script
    echo echo --preserve-test-targets > ../python.opts.sh
    chmod +x ../python.opts.sh

    JAMROOT=Jamroot.$1
}
else {
    cp -v 1_$1\_$2/bjam ..

    echo Making boost-build.jam
    rm -f ../boost-build.jam
    echo BOOST_ROOT = \$\(.boost-build-file:D\) \;>>../boost-build.jam
    echo BOOST_BUILD = \[ MATCH --boost-build=\(.*\) : \$\(ARGV\) \] \;>>../boost-build.jam
    echo BOOST_BUILD ?= Boost/1_$1_$2/tools/build/v2 \;>>../boost-build.jam
    echo boost-build \$\(BOOST_BUILD\) \;>>../boost-build.jam

    echo Making boost-version.jam
    rm -f ../boost-version.jam
    echo BOOST_VERSION_MAJOR = \"$1\" \;>> ../boost-version.jam
    echo BOOST_VERSION_MINOR = \"$2\" \;>> ../boost-version.jam
    echo BOOST_HEADERS = \"../Boost/boost/include/boost-1_\$\(BOOST_VERSION_MAJOR\)/\" \;>> ../boost-version.jam
    echo BUILD_DIRECTORY = \"../build.tmp/1_$1_$2\" \;>> ../boost-version.jam

    echo Creating target preservation script
    if test $1 -lt 38
    then {
        echo echo --preserve-test-targets > ../python.opts.sh
    } else {
        echo echo preserve-test-targets=on > ../python.opts.sh
    }
    fi
    chmod +x ../python.opts.sh

    JAMROOT=Jamroot.ownbuild-versioned-layout
}
fi
echo Using $JAMROOT
cp $JAMROOT Jamroot

echo Installing colorbb
colorbb/use_colorbb
