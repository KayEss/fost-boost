
path-constant TOP : . ;
include $(TOP)/../boost-version.jam ;

rule boost-library-clang ( curlib : dll-lib : stem-name : libver : clang-version )
{
    local prefix-clang = "boost/lib/libboost_" ;
    local clang = "-clang" ;
    local version-short = "1_$(BOOST_VERSION_MAJOR)" ;
    local version-full = "1.$(BOOST_VERSION_MAJOR).0" ;

    local filename-rel-so-full = $(prefix-clang) $(name) $(clang) $(libver) "mt-" $(version-short) ".so." $(version-full) ;
    lib $(curlib) : :
        <file>$(filename-rel-so-full:J)
        <variant>release
        <toolset-clang:version>$(clang-version) ;

    local filename-rel-so = $(prefix-clang) $(name) $(clang) $(libver) "mt-" $(version-short) ".so" ;
    lib $(dll-lib) : $(curlib) :
        <file>$(filename-rel-so:J)
        <variant>release
        <toolset-clang:version>$(clang-version) ;

    local filename-dbg-so-full = $(prefix-clang) $(name) $(clang) $(libver) "mt-" "d-" $(version-short) ".so." $(version-full) ;
    lib $(curlib) : :
        <file>$(filename-dbg-so-full:J)
        <variant>debug
        <toolset-clang:version>$(clang-version) ;

    local filename-dbg-so = $(prefix-clang) $(name) $(clang) $(libver) "mt-" "d-" $(version-short) ".so" ;
    lib $(dll-lib) : $(curlib) :
        <file>$(filename-dbg-so:J)
        <variant>debug
        <toolset-clang:version>$(clang-version) ;
}

rule boost-library-darwin ( curlib : dll-lib : stem-name : libver : gcc-version )
{
    local prefix-darwin = "boost/lib/libboost_" ;
    local prefix-iphone = "boost-iphone/lib/libboost_" ;
    local gcc = "-xgcc" ;
    local version-short = "1_$(BOOST_VERSION_MAJOR)" ;
    local version-full = "1.$(BOOST_VERSION_MAJOR).0" ;

    local filename-rel-so-full = $(name) $(gcc) $(libver) "mt-" $(version-short) ;
    lib $(curlib) : :
        <file>$(prefix-darwin)$(filename-rel-so-full:J).a
        <variant>release <target-os>darwin
        <toolset-darwin:version>$(gcc-version)
    ;
    lib $(curlib) : :
        <file>$(prefix-iphone)$(filename-rel-so-full:J).so
        <variant>release <target-os>iphone
        <toolset-darwin:version>$(gcc-version)
    ;
    local filename-rel-so = $(name) $(gcc) $(libver) "mt-" $(version-short) ;
    lib $(dll-lib) : $(curlib) :
        <file>$(prefix-darwin)$(filename-rel-so:J).dylib
        <variant>release <target-os>darwin
        <toolset-darwin:version>$(gcc-version)
    ;
    lib $(dll-lib) : $(curlib) :
        <file>$(prefix-iphone)$(filename-rel-so:J).so.$(version-full)
        <variant>release <target-os>iphone
        <toolset-darwin:version>$(gcc-version)
    ;

    local filename-dbg-so-full = $(name) $(gcc) $(libver) "mt-" "d-" $(version-short) ;
    lib $(curlib) : :
        <file>$(prefix-darwin)$(filename-dbg-so-full:J).a
        <variant>debug <target-os>darwin
        <toolset-darwin:version>$(gcc-version)
    ;
    lib $(curlib) : :
        <file>$(prefix-iphone)$(filename-dbg-so-full:J).so
        <variant>debug <target-os>iphone
        <toolset-darwin:version>$(gcc-version)
    ;
    local filename-dbg-so = $(name) $(gcc) $(libver) "mt-" "d-" $(version-short) ;
    lib $(dll-lib) : $(curlib) :
        <file>$(prefix-darwin)$(filename-dbg-so:J).dylib
        <variant>debug <target-os>darwin
        <toolset-darwin:version>$(gcc-version)
    ;
    lib $(dll-lib) : $(curlib) :
        <file>$(prefix-iphone)$(filename-dbg-so:J).so.$(version-full)
        <variant>debug <target-os>iphone
        <toolset-darwin:version>$(gcc-version)
    ;
}

rule boost-library-linux ( curlib : dll-lib : stem-name : libver : gcc-version )
{
    local prefix-lin = "boost/lib/libboost_" ;
    local gcc = "-gcc" ;
    local version-short = "1_$(BOOST_VERSION_MAJOR)" ;
    local version-full = "1.$(BOOST_VERSION_MAJOR).0" ;

    local filename-rel-so-full = $(prefix-lin) $(name) $(gcc) $(libver) "mt-" $(version-short) ".so." $(version-full) ;
    lib $(curlib) : : <file>$(filename-rel-so-full:J) <variant>release <target-os>linux <toolset-gcc:version>$(gcc-version) ;
    local filename-rel-so = $(prefix-lin) $(name) $(gcc) $(libver) "mt-" $(version-short) ".so" ;
    lib $(dll-lib) : $(curlib) : <file>$(filename-rel-so:J) <variant>release <target-os>linux <toolset-gcc:version>$(gcc-version) ;

    local filename-dbg-so-full = $(prefix-lin) $(name) $(gcc) $(libver) "mt-" "d-" $(version-short) ".so." $(version-full) ;
    lib $(curlib) : : <file>$(filename-dbg-so-full:J) <variant>debug <target-os>linux <toolset-gcc:version>$(gcc-version) ;
    local filename-dbg-so = $(prefix-lin) $(name) $(gcc) $(libver) "mt-" "d-" $(version-short) ".so" ;
    lib $(dll-lib) : $(curlib) : <file>$(filename-dbg-so:J) <variant>debug <target-os>linux <toolset-gcc:version>$(gcc-version) ;
}

rule boost-library-windows ( curlib : dll-lib : stem-name : libver : msvc-version )
{
    local prefix-win = "$(BOOST_LIBS)/boost_" ;
    local msvc = "-vc" $(libver) "-" ;
    local version = "1_$(BOOST_VERSION_MAJOR)" ;

    local filename-rel-lib = $(prefix-win) $(name) $(msvc:J) "mt-" $(version) ".lib" ;
    lib $(curlib) : : <file>$(filename-rel-lib:J) <variant>release  <target-os>windows <toolset-msvc:version>$(msvc-version) ;
    lib $(curlib) : : <file>$(filename-rel-lib:J) <variant>release-mfc  <target-os>windows <toolset-msvc:version>$(msvc-version) ;

    local filename-rel-dll = $(prefix-win) $(name) $(msvc:J) "mt-" $(version) ".dll" ;
    lib $(dll-target:J) : $(curlib) : <file>$(filename-rel-dll:J) <variant>release  <target-os>windows <toolset-msvc:version>$(msvc-version) ;
    lib $(dll-target:J) : $(curlib) : <file>$(filename-rel-dll:J) <variant>release-mfc  <target-os>windows <toolset-msvc:version>$(msvc-version) ;

    local filename-dbg-lib = $(prefix-win) $(name) $(msvc:J) "mt-" "gd-" $(version) ".lib" ;
    lib $(curlib) : : <file>$(filename-dbg-lib:J) <variant>debug  <target-os>windows <toolset-msvc:version>$(msvc-version) ;
    lib $(curlib) : : <file>$(filename-dbg-lib:J) <variant>debug-mfc  <target-os>windows <toolset-msvc:version>$(msvc-version) ;

    local filename-dbg-dll = $(prefix-win) $(name) $(msvc:J) "mt-" "gd-" $(version) ".dll" ;
    lib $(dll-target:J) : $(curlib) : <file>$(filename-dbg-dll:J) <variant>debug <target-os>windows <toolset-msvc:version>$(msvc-version) ;
    lib $(dll-target:J) : $(curlib) : <file>$(filename-dbg-dll:J) <variant>debug-mfc <target-os>windows <toolset-msvc:version>$(msvc-version) ;
}

rule boost-libraries ( libs * )
{
    local dll-targets = ;
    for local curlib in $(libs) {
        local name = [ MATCH "^boost-(.*)" : $(curlib) ] ;
        local dll-target = $(curlib) "-dll" ;
        dll-targets += $(dll-target:J) ;

        lib $(curlib) $(dll-target:J) ;

        boost-library-clang $(curlib) : $(dll-target:J) : $(name) : "29-" : "2.9" ;
        boost-library-clang $(curlib) : $(dll-target:J) : $(name) : "30-" : "3.0" ;
        boost-library-clang $(curlib) : $(dll-target:J) : $(name) : "32-" : "3.2" ;
        boost-library-clang $(curlib) : $(dll-target:J) : $(name) : "33-" : "3.3" ;
        boost-library-clang $(curlib) : $(dll-target:J) : $(name) : "34-" : "3.4" ;
        boost-library-clang $(curlib) : $(dll-target:J) : $(name) : "35-" : "3.5" ;
        boost-library-clang $(curlib) : $(dll-target:J) : $(name) : "35-" : "3.5.0" ;
        boost-library-clang $(curlib) : $(dll-target:J) : $(name) : "36-" : "3.6.0" ;

        boost-library-darwin $(curlib) : $(dll-target:J) : $(name) : "40-" : "4.0.1" ;
        boost-library-darwin $(curlib) : $(dll-target:J) : $(name) : "42-" : "4.2.1" ;

        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "42-" : "4.2.3" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "42-" : "4.2.4" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "43-" : "4.3.2" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "43-" : "4.3.3" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "44-" : "4.4.1" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "44-" : "4.4.3" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "44-" : "4.4.4" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "44-" : "4.4.5" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "45-" : "4.5.2" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "46-" : "4.6" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "46-" : "4.6.1" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "46-" : "4.6.3" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "47-" : "4.7" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "48-" : "4.8" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "49-" : "4.9.1" ;
        boost-library-linux $(curlib) : $(dll-target:J) : $(name) : "49-" : "4.9.2" ;

        boost-library-windows $(curlib) : $(dll-target:J) : $(name) : "80" : "8.0" ;
        boost-library-windows $(curlib) : $(dll-target:J) : $(name) : "90" : "9.0" ;
        boost-library-windows $(curlib) : $(dll-target:J) : $(name) : "90" : "9.0express" ;
        boost-library-windows $(curlib) : $(dll-target:J) : $(name) : "100" : "10.0" ;
        boost-library-windows $(curlib) : $(dll-target:J) : $(name) : "120" : "12.0" ;
    }

    install ../dist/bin : $(dll-targets) : <install-dependencies>on ;
}

boost-libraries
        boost-chrono
        boost-coroutine
        boost-date_time
        boost-filesystem
        boost-graph
        boost-iostreams
        boost-math_c99
        boost-math_c99f
        boost-math_c99l
        boost-math_tr1
        boost-math_tr1f
        boost-math_tr1l
        boost-prg_exec_monitor
        boost-program_options
        boost-python
        boost-regex
        boost-serialization
        boost-signals
        boost-system
        boost-thread
        boost-unit_test_framework
        boost-wave
        boost-wserialization
    ;
