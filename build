#! /bin/bash
set -e
cd `dirname $0`

if test -z $1
then {
    export MAJOR=41
} else {
    export MAJOR=$1
}
fi

if test -z $2
then {
    export MINOR=0
} else {
    export MINOR=$2
}
fi

export VERSION=1_$MAJOR\_$MINOR
echo Using 1.$MAJOR.$MINOR

if test ! -e src
then {
    git clone git@github.com:boostorg/boost.git src
    cd src
}
else {
    cd src
    git fetch
}
fi
rm -rf project-config.jam* bin.v2 b2 bjam
git checkout --force boost-1.$MAJOR.$MINOR
git submodule init
git submodule sync
git submodule update

if test -e ../gcc.jam.$VERSION.darwin
then {
    cp -v ../gcc.jam.$VERSION.darwin tools/build/v2/tools/gcc.jam
}
fi

echo Create build tools
if test ! -e bootstrap.sh
then {
    cd tools/jam
    ./build_dist.sh
    cp -v `ls -d stage/bin.*`/bjam ../..
    cd ../..
}
else {
    ./bootstrap.sh
}
fi

../compile $MAJOR $MINOR
if test -z $1
then {
    cd ..
    ./install $MAJOR $MINOR
}
fi

