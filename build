#! /bin/bash
cd `dirname $0`
set -ex

if test -z $1
then {
    export MAJOR=62
} else {
    export MAJOR=$1
}
fi

if test -z $2
then {
    export MINOR=0
} else {
    export MINOR=$2
}
fi

export VERSION=1_$MAJOR\_$MINOR
echo Using Boost_$VERSION

if test ! -e $VERSION
then {
    if test ! -e $VERSION.tar.bz2
    then {
        wget -c -O $VERSION.tar.bz2 http://sourceforge.net/projects/boost/files/boost/1.$MAJOR.$MINOR/boost_$VERSION.tar.bz2/download
    }
    fi
    tar xf $VERSION.tar.bz2
    mv boost_$VERSION $VERSION
}
fi

if test -e gcc.jam.$VERSION.darwin
then {
    cp -v gcc.jam.$VERSION.darwin $VERSION/tools/build/v2/tools/gcc.jam
}
fi

if test ! -e ./bjam
then {
    cd boost-build
    echo Create build tools
    ./bootstrap.sh
    cp bjam ..
    cd ..
}
fi

cp bjam $VERSION
cd $VERSION
echo Making boost-build.jam
rm -f boost-build.jam
echo BOOST_ROOT = \$\(.boost-build-file:D\) \;>>boost-build.jam
echo BOOST_BUILD = \[ MATCH --boost-build=\(.*\) : \$\(ARGV\) \] \;>>boost-build.jam
echo BOOST_BUILD ?= ../boost-build/src \;>>boost-build.jam
echo boost-build \$\(BOOST_BUILD\) \;>>boost-build.jam

../compile $MAJOR $MINOR
if test -z $1
then {
    cd ..
    ./install $MAJOR $MINOR
}
fi

